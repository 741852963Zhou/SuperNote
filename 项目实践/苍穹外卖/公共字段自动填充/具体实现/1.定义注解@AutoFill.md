
这是实现公共字段自动填充的第一步。根据 [[项目实践/苍穹外卖/公共字段自动填充/解决方案|解决方案]]，我们需要一个“标记”来告诉AOP哪些方法需要被拦截。

这个“标记”就是一个自定义的 [[知识库/java基础/Java-注解(Annotation)/Java-注解-自定义注解|Java-注解-自定义注解]]。

## 1. 代码实现

我们在 `sky-server` 模块的 `com.sky.annotation` 包下创建 `AutoFill` 注解。


```java

package com.sky.annotation;


import com.sky.enumeration.OperationType;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * 自定义注解，用于标识某个方法需要进行功能字段自动填充处理
 * @author 741852963zhou
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AutoFill {
    // 数据库操作类型：UPDATE INSERT
    OperationType value();
}

```
## 2. 代码解析

### 2.1. 元注解

我们在这个注解上使用了两个 [[知识库/java基础/Java-注解(Annotation)/Java-注解-元注解|Java-注解-元注解]]：

1. `@Target(ElementType.METHOD)`

    - `@Target` 限制了这个注解**能用在哪里**。
        
    - `ElementType.METHOD` 说明 `@AutoFill` 只能被用在**方法**上（例如 `insert` 或 `update` 方法）。
        
2. `@Retention(RetentionPolicy.RUNTIME)`
    
    - `@Retention` 决定了这个注解的**生命周期**。
        
    - `RetentionPolicy.RUNTIME` 是**必须的**，它保证了注解在程序**运行时**依然存在，这样我们的 AOP 切面才能通过 [[知识库/java基础/Java-反射/Java-反射 (MOC)|Java-反射|]]来读取到它。
        

### 2.2. 属性 `OperationType value();`

这是注解的核心。在我们深入的讨论中，我们了解到：

- 这不是一个真正的方法，而是 `[[知识库/java基础/Java-注解(Annotation)/Java-注解-自定义注解|Java-注解-自定义注解]]` 声明**属性**的特殊语法。
    
- `OperationType` 是这个属性的**数据类型**，它是一个枚举。我们将在下一篇笔记中定义它：[[项目实践/苍穹外卖/公共字段自动填充/具体实现/2.定义枚举类OperationType|2.定义枚举类OperationType]]。
    
- `value` 是这个属性的**名字**。使用 `value` 作为名字是一个惯例，它允许我们在使用注解时省略属性名，直接写成 `@AutoFill(OperationType.INSERT)`，而不是 `@AutoFill(value = OperationType.INSERT)`。
    

## 3. 应用示例

定义好后，我们就可以在 `Mapper` 接口中“贴”上这个标签，明确标记需要AOP拦截的方法。

`EmployeeMapper.java` 示例：

```java
@Mapper
public interface EmployeeMapper {
    
    // ...

    @AutoFill(OperationType.INSERT)
    @Insert("insert into employee (username, name, ...)")
    void insert(Employee employee);

    @AutoFill(value = OperationType.UPDATE)
    void updateEmployee(Employee employee);
    
    // ...
}
```